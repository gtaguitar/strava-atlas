{"version":3,"file":"js/hub.js","mappings":"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","sources":["webpack://strava-atlas/./node_modules/cross-storage/lib/client.js","webpack://strava-atlas/./node_modules/cross-storage/lib/hub.js","webpack://strava-atlas/./node_modules/cross-storage/lib/index.js","webpack://strava-atlas/./src/JSONStorageItem.ts","webpack://strava-atlas/./src/hub.ts","webpack://strava-atlas/webpack/bootstrap","webpack://strava-atlas/webpack/startup"],"sourcesContent":[";(function(root) {\n  /**\n   * Constructs a new cross storage client given the url to a hub. By default,\n   * an iframe is created within the document body that points to the url. It\n   * also accepts an options object, which may include a timeout, frameId, and\n   * promise. The timeout, in milliseconds, is applied to each request and\n   * defaults to 5000ms. The options object may also include a frameId,\n   * identifying an existing frame on which to install its listeners. If the\n   * promise key is supplied the constructor for a Promise, that Promise library\n   * will be used instead of the default window.Promise.\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html');\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html', {\n   *   timeout: 5000,\n   *   frameId: 'storageFrame'\n   * });\n   *\n   * @constructor\n   *\n   * @param {string} url    The url to a cross storage hub\n   * @param {object} [opts] An optional object containing additional options,\n   *                        including timeout, frameId, and promise\n   *\n   * @property {string}   _id        A UUID v4 id\n   * @property {function} _promise   The Promise object to use\n   * @property {string}   _frameId   The id of the iFrame pointing to the hub url\n   * @property {string}   _origin    The hub's origin\n   * @property {object}   _requests  Mapping of request ids to callbacks\n   * @property {bool}     _connected Whether or not it has connected\n   * @property {bool}     _closed    Whether or not the client has closed\n   * @property {int}      _count     Number of requests sent\n   * @property {function} _listener  The listener added to the window\n   * @property {Window}   _hub       The hub window\n   */\n  function CrossStorageClient(url, opts) {\n    opts = opts || {};\n\n    this._id        = CrossStorageClient._generateUUID();\n    this._promise   = opts.promise || Promise;\n    this._frameId   = opts.frameId || 'CrossStorageClient-' + this._id;\n    this._origin    = CrossStorageClient._getOrigin(url);\n    this._requests  = {};\n    this._connected = false;\n    this._closed    = false;\n    this._count     = 0;\n    this._timeout   = opts.timeout || 5000;\n    this._listener  = null;\n\n    this._installListener();\n\n    var frame;\n    if (opts.frameId) {\n      frame = document.getElementById(opts.frameId);\n    }\n\n    // If using a passed iframe, poll the hub for a ready message\n    if (frame) {\n      this._poll();\n    }\n\n    // Create the frame if not found or specified\n    frame = frame || this._createFrame(url);\n    this._hub = frame.contentWindow;\n  }\n\n  /**\n   * The styles to be applied to the generated iFrame. Defines a set of properties\n   * that hide the element by positioning it outside of the visible area, and\n   * by modifying its display.\n   *\n   * @member {Object}\n   */\n  CrossStorageClient.frameStyle = {\n    display:  'none',\n    position: 'absolute',\n    top:      '-999px',\n    left:     '-999px'\n  };\n\n  /**\n   * Returns the origin of an url, with cross browser support. Accommodates\n   * the lack of location.origin in IE, as well as the discrepancies in the\n   * inclusion of the port when using the default port for a protocol, e.g.\n   * 443 over https. Defaults to the origin of window.location if passed a\n   * relative path.\n   *\n   * @param   {string} url The url to a cross storage hub\n   * @returns {string} The origin of the url\n   */\n  CrossStorageClient._getOrigin = function(url) {\n    var uri, protocol, origin;\n\n    uri = document.createElement('a');\n    uri.href = url;\n\n    if (!uri.host) {\n      uri = window.location;\n    }\n\n    if (!uri.protocol || uri.protocol === ':') {\n      protocol = window.location.protocol;\n    } else {\n      protocol = uri.protocol;\n    }\n\n    origin = protocol + '//' + uri.host;\n    origin = origin.replace(/:80$|:443$/, '');\n\n    return origin;\n  };\n\n  /**\n   * UUID v4 generation, taken from: http://stackoverflow.com/questions/\n   * 105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n   *\n   * @returns {string} A UUID v4 string\n   */\n  CrossStorageClient._generateUUID = function() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\n      return v.toString(16);\n    });\n  };\n\n  /**\n   * Returns a promise that is fulfilled when a connection has been established\n   * with the cross storage hub. Its use is required to avoid sending any\n   * requests prior to initialization being complete.\n   *\n   * @returns {Promise} A promise that is resolved on connect\n   */\n  CrossStorageClient.prototype.onConnect = function() {\n    var client = this;\n\n    if (this._connected) {\n      return this._promise.resolve();\n    } else if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    // Queue connect requests for client re-use\n    if (!this._requests.connect) {\n      this._requests.connect = [];\n    }\n\n    return new this._promise(function(resolve, reject) {\n      var timeout = setTimeout(function() {\n        reject(new Error('CrossStorageClient could not connect'));\n      }, client._timeout);\n\n      client._requests.connect.push(function(err) {\n        clearTimeout(timeout);\n        if (err) return reject(err);\n\n        resolve();\n      });\n    });\n  };\n\n  /**\n   * Sets a key to the specified value. Returns a promise that is fulfilled on\n   * success, or rejected if any errors setting the key occurred, or the request\n   * timed out.\n   *\n   * @param   {string}  key   The key to set\n   * @param   {*}       value The value to assign\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.set = function(key, value) {\n    return this._request('set', {\n      key:   key,\n      value: value\n    });\n  };\n\n  /**\n   * Accepts one or more keys for which to retrieve their values. Returns a\n   * promise that is settled on hub response or timeout. On success, it is\n   * fulfilled with the value of the key if only passed a single argument.\n   * Otherwise it's resolved with an array of values. On failure, it is rejected\n   * with the corresponding error message.\n   *\n   * @param   {...string} key The key to retrieve\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.get = function(key) {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('get', {keys: args});\n  };\n\n  /**\n   * Accepts one or more keys for deletion. Returns a promise that is settled on\n   * hub response or timeout.\n   *\n   * @param   {...string} key The key to delete\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.del = function() {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('del', {keys: args});\n  };\n\n  /**\n   * Returns a promise that, when resolved, indicates that all localStorage\n   * data has been cleared.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.clear = function() {\n    return this._request('clear');\n  };\n\n  /**\n   * Returns a promise that, when resolved, passes an array of all keys\n   * currently in storage.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.getKeys = function() {\n    return this._request('getKeys');\n  };\n\n  /**\n   * Deletes the iframe and sets the connected state to false. The client can\n   * no longer be used after being invoked.\n   */\n  CrossStorageClient.prototype.close = function() {\n    var frame = document.getElementById(this._frameId);\n    if (frame) {\n      frame.parentNode.removeChild(frame);\n    }\n\n    // Support IE8 with detachEvent\n    if (window.removeEventListener) {\n      window.removeEventListener('message', this._listener, false);\n    } else {\n      window.detachEvent('onmessage', this._listener);\n    }\n\n    this._connected = false;\n    this._closed = true;\n  };\n\n  /**\n   * Installs the necessary listener for the window message event. When a message\n   * is received, the client's _connected status is changed to true, and the\n   * onConnect promise is fulfilled. Given a response message, the callback\n   * corresponding to its request is invoked. If response.error holds a truthy\n   * value, the promise associated with the original request is rejected with\n   * the error. Otherwise the promise is fulfilled and passed response.result.\n   *\n   * @private\n   */\n  CrossStorageClient.prototype._installListener = function() {\n    var client = this;\n\n    this._listener = function(message) {\n      var i, origin, error, response;\n\n      // Ignore invalid messages or those after the client has closed\n      if (client._closed || !message.data || typeof message.data !== 'string') {\n        return;\n      }\n\n      // postMessage returns the string \"null\" as the origin for \"file://\"\n      origin = (message.origin === 'null') ? 'file://' : message.origin;\n\n      // Ignore messages not from the correct origin\n      if (origin !== client._origin) return;\n\n      // LocalStorage isn't available in the hub\n      if (message.data === 'cross-storage:unavailable') {\n        if (!client._closed) client.close();\n        if (!client._requests.connect) return;\n\n        error = new Error('Closing client. Could not access localStorage in hub.');\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n\n        return;\n      }\n\n      // Handle initial connection\n      if (message.data.indexOf('cross-storage:') !== -1 && !client._connected) {\n        client._connected = true;\n        if (!client._requests.connect) return;\n\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n        delete client._requests.connect;\n      }\n\n      if (message.data === 'cross-storage:ready') return;\n\n      // All other messages\n      try {\n        response = JSON.parse(message.data);\n      } catch(e) {\n        return;\n      }\n\n      if (!response.id) return;\n\n      if (client._requests[response.id]) {\n        client._requests[response.id](response.error, response.result);\n      }\n    };\n\n    // Support IE8 with attachEvent\n    if (window.addEventListener) {\n      window.addEventListener('message', this._listener, false);\n    } else {\n      window.attachEvent('onmessage', this._listener);\n    }\n  };\n\n  /**\n   * Invoked when a frame id was passed to the client, rather than allowing\n   * the client to create its own iframe. Polls the hub for a ready event to\n   * establish a connected state.\n   */\n  CrossStorageClient.prototype._poll = function() {\n    var client, interval, targetOrigin;\n\n    client = this;\n\n    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n    targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n    interval = setInterval(function() {\n      if (client._connected) return clearInterval(interval);\n      if (!client._hub) return;\n\n      client._hub.postMessage('cross-storage:poll', targetOrigin);\n    }, 1000);\n  };\n\n  /**\n   * Creates a new iFrame containing the hub. Applies the necessary styles to\n   * hide the element from view, prior to adding it to the document body.\n   * Returns the created element.\n   *\n   * @private\n   *\n   * @param  {string}            url The url to the hub\n   * returns {HTMLIFrameElement} The iFrame element itself\n   */\n  CrossStorageClient.prototype._createFrame = function(url) {\n    var frame, key;\n\n    frame = window.document.createElement('iframe');\n    frame.id = this._frameId;\n\n    // Style the iframe\n    for (key in CrossStorageClient.frameStyle) {\n      if (CrossStorageClient.frameStyle.hasOwnProperty(key)) {\n        frame.style[key] = CrossStorageClient.frameStyle[key];\n      }\n    }\n\n    window.document.body.appendChild(frame);\n    frame.src = url;\n\n    return frame;\n  };\n\n  /**\n   * Sends a message containing the given method and params to the hub. Stores\n   * a callback in the _requests object for later invocation on message, or\n   * deletion on timeout. Returns a promise that is settled in either instance.\n   *\n   * @private\n   *\n   * @param   {string}  method The method to invoke\n   * @param   {*}       params The arguments to pass\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype._request = function(method, params) {\n    var req, client;\n\n    if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    client = this;\n    client._count++;\n\n    req = {\n      id:     this._id + ':' + client._count,\n      method: 'cross-storage:' + method,\n      params: params\n    };\n\n    return new this._promise(function(resolve, reject) {\n      var timeout, originalToJSON, targetOrigin;\n\n      // Timeout if a response isn't received after 4s\n      timeout = setTimeout(function() {\n        if (!client._requests[req.id]) return;\n\n        delete client._requests[req.id];\n        reject(new Error('Timeout: could not perform ' + req.method));\n      }, client._timeout);\n\n      // Add request callback\n      client._requests[req.id] = function(err, result) {\n        clearTimeout(timeout);\n        delete client._requests[req.id];\n        if (err) return reject(new Error(err));\n        resolve(result);\n      };\n\n      // In case we have a broken Array.prototype.toJSON, e.g. because of\n      // old versions of prototype\n      if (Array.prototype.toJSON) {\n        originalToJSON = Array.prototype.toJSON;\n        Array.prototype.toJSON = null;\n      }\n\n      // postMessage requires that the target origin be set to \"*\" for \"file://\"\n      targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n      // Send serialized message\n      client._hub.postMessage(JSON.stringify(req), targetOrigin);\n\n      // Restore original toJSON\n      if (originalToJSON) {\n        Array.prototype.toJSON = originalToJSON;\n      }\n    });\n  };\n\n  /**\n   * Export for various environments.\n   */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CrossStorageClient;\n  } else if (typeof exports !== 'undefined') {\n    exports.CrossStorageClient = CrossStorageClient;\n  } else if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return CrossStorageClient;\n    });\n  } else {\n    root.CrossStorageClient = CrossStorageClient;\n  }\n}(this));\n",";(function(root) {\n  var CrossStorageHub = {};\n\n  /**\n   * Accepts an array of objects with two keys: origin and allow. The value\n   * of origin is expected to be a RegExp, and allow, an array of strings.\n   * The cross storage hub is then initialized to accept requests from any of\n   * the matching origins, allowing access to the associated lists of methods.\n   * Methods may include any of: get, set, del, getKeys and clear. A 'ready'\n   * message is sent to the parent window once complete.\n   *\n   * @example\n   * // Subdomain can get, but only root domain can set and del\n   * CrossStorageHub.init([\n   *   {origin: /\\.example.com$/,        allow: ['get']},\n   *   {origin: /:(www\\.)?example.com$/, allow: ['get', 'set', 'del']}\n   * ]);\n   *\n   * @param {array} permissions An array of objects with origin and allow\n   */\n  CrossStorageHub.init = function(permissions) {\n    var available = true;\n\n    // Return if localStorage is unavailable, or third party\n    // access is disabled\n    try {\n      if (!window.localStorage) available = false;\n    } catch (e) {\n      available = false;\n    }\n\n    if (!available) {\n      try {\n        return window.parent.postMessage('cross-storage:unavailable', '*');\n      } catch (e) {\n        return;\n      }\n    }\n\n    CrossStorageHub._permissions = permissions || [];\n    CrossStorageHub._installListener();\n    window.parent.postMessage('cross-storage:ready', '*');\n  };\n\n  /**\n   * Installs the necessary listener for the window message event. Accommodates\n   * IE8 and up.\n   *\n   * @private\n   */\n  CrossStorageHub._installListener = function() {\n    var listener = CrossStorageHub._listener;\n    if (window.addEventListener) {\n      window.addEventListener('message', listener, false);\n    } else {\n      window.attachEvent('onmessage', listener);\n    }\n  };\n\n  /**\n   * The message handler for all requests posted to the window. It ignores any\n   * messages having an origin that does not match the originally supplied\n   * pattern. Given a JSON object with one of get, set, del or getKeys as the\n   * method, the function performs the requested action and returns its result.\n   *\n   * @param {MessageEvent} message A message to be processed\n   */\n  CrossStorageHub._listener = function(message) {\n    var origin, targetOrigin, request, method, error, result, response;\n\n    // postMessage returns the string \"null\" as the origin for \"file://\"\n    origin = (message.origin === 'null') ? 'file://' : message.origin;\n\n    // Handle polling for a ready message\n    if (message.data === 'cross-storage:poll') {\n      return window.parent.postMessage('cross-storage:ready', message.origin);\n    }\n\n    // Ignore the ready message when viewing the hub directly\n    if (message.data === 'cross-storage:ready') return;\n\n    // Check whether message.data is a valid json\n    try {\n      request = JSON.parse(message.data);\n    } catch (err) {\n      return;\n    }\n\n    // Check whether request.method is a string\n    if (!request || typeof request.method !== 'string') {\n      return;\n    }\n\n    method = request.method.split('cross-storage:')[1];\n\n    if (!method) {\n      return;\n    } else if (!CrossStorageHub._permitted(origin, method)) {\n      error = 'Invalid permissions for ' + method;\n    } else {\n      try {\n        result = CrossStorageHub['_' + method](request.params);\n      } catch (err) {\n        error = err.message;\n      }\n    }\n\n    response = JSON.stringify({\n      id: request.id,\n      error: error,\n      result: result\n    });\n\n    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n    targetOrigin = (origin === 'file://') ? '*' : origin;\n\n    window.parent.postMessage(response, targetOrigin);\n  };\n\n  /**\n   * Returns a boolean indicating whether or not the requested method is\n   * permitted for the given origin. The argument passed to method is expected\n   * to be one of 'get', 'set', 'del' or 'getKeys'.\n   *\n   * @param   {string} origin The origin for which to determine permissions\n   * @param   {string} method Requested action\n   * @returns {bool}   Whether or not the request is permitted\n   */\n  CrossStorageHub._permitted = function(origin, method) {\n    var available, i, entry, match;\n\n    available = ['get', 'set', 'del', 'clear', 'getKeys'];\n    if (!CrossStorageHub._inArray(method, available)) {\n      return false;\n    }\n\n    for (i = 0; i < CrossStorageHub._permissions.length; i++) {\n      entry = CrossStorageHub._permissions[i];\n      if (!(entry.origin instanceof RegExp) || !(entry.allow instanceof Array)) {\n        continue;\n      }\n\n      match = entry.origin.test(origin);\n      if (match && CrossStorageHub._inArray(method, entry.allow)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * Sets a key to the specified value.\n   *\n   * @param {object} params An object with key and value\n   */\n  CrossStorageHub._set = function(params) {\n    window.localStorage.setItem(params.key, params.value);\n  };\n\n  /**\n   * Accepts an object with an array of keys for which to retrieve their values.\n   * Returns a single value if only one key was supplied, otherwise it returns\n   * an array. Any keys not set result in a null element in the resulting array.\n   *\n   * @param   {object} params An object with an array of keys\n   * @returns {*|*[]}  Either a single value, or an array\n   */\n  CrossStorageHub._get = function(params) {\n    var storage, result, i, value;\n\n    storage = window.localStorage;\n    result = [];\n\n    for (i = 0; i < params.keys.length; i++) {\n      try {\n        value = storage.getItem(params.keys[i]);\n      } catch (e) {\n        value = null;\n      }\n\n      result.push(value);\n    }\n\n    return (result.length > 1) ? result : result[0];\n  };\n\n  /**\n   * Deletes all keys specified in the array found at params.keys.\n   *\n   * @param {object} params An object with an array of keys\n   */\n  CrossStorageHub._del = function(params) {\n    for (var i = 0; i < params.keys.length; i++) {\n      window.localStorage.removeItem(params.keys[i]);\n    }\n  };\n\n  /**\n   * Clears localStorage.\n   */\n  CrossStorageHub._clear = function() {\n    window.localStorage.clear();\n  };\n\n  /**\n   * Returns an array of all keys stored in localStorage.\n   *\n   * @returns {string[]} The array of keys\n   */\n  CrossStorageHub._getKeys = function(params) {\n    var i, length, keys;\n\n    keys = [];\n    length = window.localStorage.length;\n\n    for (i = 0; i < length; i++) {\n      keys.push(window.localStorage.key(i));\n    }\n\n    return keys;\n  };\n\n  /**\n   * Returns whether or not a value is present in the array. Consists of an\n   * alternative to extending the array prototype for indexOf, since it's\n   * unavailable for IE8.\n   *\n   * @param   {*}    value The value to find\n   * @parma   {[]*}  array The array in which to search\n   * @returns {bool} Whether or not the value was found\n   */\n  CrossStorageHub._inArray = function(value, array) {\n    for (var i = 0; i < array.length; i++) {\n      if (value === array[i]) return true;\n    }\n\n    return false;\n  };\n\n  /**\n   * A cross-browser version of Date.now compatible with IE8 that avoids\n   * modifying the Date object.\n   *\n   * @return {int} The current timestamp in milliseconds\n   */\n  CrossStorageHub._now = function() {\n    if (typeof Date.now === 'function') {\n      return Date.now();\n    }\n\n    return new Date().getTime();\n  };\n\n  /**\n   * Export for various environments.\n   */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CrossStorageHub;\n  } else if (typeof exports !== 'undefined') {\n    exports.CrossStorageHub = CrossStorageHub;\n  } else if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return CrossStorageHub;\n    });\n  } else {\n    root.CrossStorageHub = CrossStorageHub;\n  }\n}(this));\n","module.exports = {\n  CrossStorageClient: require('./client.js'),\n  CrossStorageHub:    require('./hub.js')\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass JSONStorageItem {\n    constructor(key) {\n        this.key = key;\n    }\n    get() {\n        const maybeStr = localStorage.getItem(this.key);\n        return maybeStr !== null ? JSON.parse(maybeStr) : null;\n    }\n    set(value) {\n        this.setRaw(JSON.stringify(value));\n    }\n    setRaw(str) {\n        localStorage.setItem(this.key, str);\n    }\n    remove() {\n        return localStorage.removeItem(this.key);\n    }\n}\nexports.default = JSONStorageItem;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst cross_storage_1 = require(\"cross-storage\");\nconst JSONStorageItem_1 = __importDefault(require(\"./JSONStorageItem\"));\nconst permissionsStorage = new JSONStorageItem_1.default('crossStoragePermissions');\nconst permissions = permissionsStorage.get();\nif (permissions) {\n    const permissionsRegExp = permissions.map(p => (Object.assign(Object.assign({}, p), { origin: new RegExp(p.origin) })));\n    cross_storage_1.CrossStorageHub.init(permissionsRegExp);\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(3296);\n"],"names":["root","CrossStorageClient","url","opts","frame","this","_id","_generateUUID","_promise","promise","Promise","_frameId","frameId","_origin","_getOrigin","_requests","_connected","_closed","_count","_timeout","timeout","_listener","_installListener","document","getElementById","_poll","_createFrame","_hub","contentWindow","frameStyle","display","position","top","left","uri","createElement","href","host","window","location","protocol","replace","c","r","Math","random","toString","prototype","onConnect","client","resolve","reject","Error","connect","setTimeout","push","err","clearTimeout","set","key","value","_request","get","args","Array","slice","call","arguments","keys","del","clear","getKeys","close","parentNode","removeChild","removeEventListener","detachEvent","message","i","error","response","data","origin","indexOf","length","JSON","parse","e","id","result","addEventListener","attachEvent","interval","targetOrigin","setInterval","clearInterval","postMessage","hasOwnProperty","style","body","appendChild","src","method","params","req","originalToJSON","toJSON","stringify","module","exports","CrossStorageHub","permissions","available","localStorage","parent","_permissions","listener","request","split","_permitted","entry","_inArray","RegExp","allow","test","setItem","storage","getItem","removeItem","array","Date","now","getTime","Object","defineProperty","constructor","maybeStr","setRaw","str","remove","__importDefault","mod","__esModule","cross_storage_1","default","permissionsRegExp","map","p","assign","init","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__"],"sourceRoot":""}